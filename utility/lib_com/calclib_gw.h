/****************************************Copyright (c)**************************************************
**                                  ____科技有限公司
**                                          开发部
**
**
**--------------文件信息--------------------------------------------------------------------------------
**文   件   名: GD_cal.h
**创   建   人: yzy
**最后修改日期: 2019-06-18
**描        述: 国电函数库头文件
**注        意:
**--------------历史版本信息----------------------------------------------------------------------------
** 创建人: yzy
** 版  本: v1.0
** 日　期: 2019-06-18
** 描　述: 原始版本
********************************************************************************************************/
#ifndef _GD_CAL_H_
#define _GD_CAL_H_


#ifndef EXT_GD_CAL
#define EXT_GD_CAL extern
#endif









/************************************************************************
**建立时间标签时输入的时间类型
*************************************************************************/
typedef enum
{
    TTYPE_YMDHMS = 0,
    TTYPE_SMHDMY,
    TTYPE_MINS,
}E_TTYPE;






/************************************************************************
 * @function: FMT_UnifyTime
 * @描述: 将mHDMY压缩成4字节格式
 * 
 * @参数: 
 * @param: time 输入时间
 * @param: isbcd 输入格式(假hex,真bcd)
 * @param: bigendian 输入顺序(假:分时日月年,真:年月日时分)
 * 
 * @返回: 
 * @return: uint32 
 * @说明: 该格式中,数值大小与时间后先具有正相关性
 * @作者: yzy (2011-11-25)
 *-----------------------------------------------------------------------
 * @修改人: 
 ************************************************************************/
uint32 FMT_UnifyTime(uint8* time, bool isbcd, bool bigendian);


/************************************************************************
 * @function: FMT_ReUnifyTime
 * @描述: 将4字节时间格式还原成mHDMY
 * 
 * @参数: 
 * @param: out 输出
 * @param: unify 输入4字节时间
 * @param: isbcd 输出格式(假hex,真bcd)
 * @param: bigendian 输出顺序(假:分时日月年,真:年月日时分)
 * @返回: 
 * @说明: 
 * @作者: yzy (2011-11-25)
 *-----------------------------------------------------------------------
 * @修改人: 
 ************************************************************************/
void FMT_ReUnifyTime(uint8* out, uint32 unify, bool isbcd, bool bigendian);


/************************************************************************
 * @function: BuildTimeLabel
 * @描述: 创建时间标签
 * 
 * @参数: 
 * @param: ttype 
 * @param: input 
 * @param: output 
 * 
 * @返回: 
 * @return: uint8  成功/失败
 * @说明: 
 * @作者: yzy (2011-3-5)
 *-----------------------------------------------------------------------
 * @修改人: 
 ************************************************************************/
uint8 BuildTimeLabel(E_TTYPE ttype, uint8* input, S_TimeLabel* output);


/************************************************************************
 * @function: CheckTimeLabel
 * @描述: 校验时间标识
 * 
 * @参数: 
 * @param: stl 
 * 
 * @返回: 
 * @return: uint8  
 * @说明: 
 * @作者: yzy (2011-3-5)
 *-----------------------------------------------------------------------
 * @修改人: 
 ************************************************************************/
uint8 CheckTimeLabel(S_TimeLabel* stl);

/************************************************************************
 * @function: PentCfgToSS
 * @描述: 透明转发控制字转成串口结构体格式
 * 
 * @参数: 
 * @param: cfg
 * @param: ss 
 * @返回: 
 * @说明: 
 * @作者: yzy (2011-9-30)
 *-----------------------------------------------------------------------
 * @修改人: 
 ************************************************************************/
uint8 PentCfgToSS(uint8 cfg, uart_config_t* ss);

/******************************************************************************
**定义极值结构体
******************************************************************************/
typedef struct
{
    uint16 mAttrib;                     //该比较项的性质
    uint8  mHour;                       //发生时间BCD
    uint8  mMinute;                     //发生分钟BCD
    uint32 mVal;                        //当前的极值
}STATCmper;


#define STAT_CMP_MAX    0
#define STAT_CMP_MIN    1
#define STAT_CMP_NEG    2

/************************************************************************
** 函数名称: void STAT_MaxValue(void)
** 描 述: 统计数据的日最大值处理
** 输 入:  cmper 统计数据结构体
            val 当前的数值
** 输 出:
**
** 作 者: yzy
** 日 期: 2008年4月13日
**-----------------------------------------------------------------------
** 修 改: yzy
** 内 容: 增加了cmper->mAttrib的赋值(为了调试时清晰,并无实际作用)
** 日 期: 2008-10-7
*************************************************************************/
bool STAT_MaxValue(STATCmper* cmper, uint32 val);

/************************************************************************
** 函数名称: void STAT_MaxValue(void)
** 描 述: 统计数据的日最小值处理
** 输 入: cmper 统计数据结构体
**        val 当前的数值
** 输 出:
**
** 作 者: yzy
** 日 期: 2008年4月13日
**-----------------------------------------------------------------------
** 修 改: yzy
** 内 容: 增加了cmper->mAttrib的赋值
** 日 期: 2008-10-7
*************************************************************************/
bool STAT_MinValue(STATCmper* cmper, uint32 val);

/************************************************************************
** 函数名称: void STAT_SignedMaxValue(void)
** 描 述: 有符号统计数据的日最大值处理
** 输 入: cmper 统计数据结构体
**        val 当前的数值
** 输 出:
**
** 作 者: yzy
** 日 期: 2008年4月13日
**-----------------------------------------------------------------------
** 修 改: yzy
** 内 容: 增加了cmper->mAttrib的赋值
** 日 期: 2008-10-7
*************************************************************************/
bool STAT_SignedMaxValue(STATCmper* cmper, int32 val);

/************************************************************************
** 函数名称: void STAT_SignedMinValue(void)
** 描 述: 有符号统计数据的日最小值处理
** 输 入:  cmper 统计数据结构体
**         val 当前的数值
** 输 出:
**
** 作 者: yzy
** 日 期: 2008年4月13日
**-----------------------------------------------------------------------
** 修 改: yzy
** 内 容: 增加了cmper->mAttrib的赋值
** 日 期: 2008-10-7
*************************************************************************/
bool STAT_SignedMinValue(STATCmper* cmper, int32 val);

/************************************************************************
**函数名称: void StepForward_15Mins(uint8* time, bool isym)
**描 述: 将time时间定格到之后最近的一刻钟时间
**
**输 入: time YYMMDDHHmm(isym真, HEX), 
**            mmHHDDMMYY(isym假)
**输 出: 
**
**备 注: 用于小时曲线数据(如输入:07-08-02 15:23;输出为07-08-02 15:30)
**-----------------------------------------------------------------------
**作 者: 
**日 期: 
*************************************************************************/
void StepForward_15Mins(uint8* time, bool isym);

/************************************************************************
**函数名称: void StepForward_60Mins(uint8* time, bool isym)
**描 述: 将time时间定格到之后最近的一刻钟时间
**
**输 入: time YYMMDDHHmm(isym真,HEX),
**            mmHHDDMMYY(isym假)
**输 出: 
**
**备 注: 用于小时曲线数据(如输入:07-08-02 15:23;输出为07-08-02 16:00)
**-----------------------------------------------------------------------
**作 者: 
**日 期: 
*************************************************************************/
void StepForward_60Mins(uint8* time, bool isym);

/************************************************************************
**函数名称: uint8 ValueToHexChar(uint8 val, bool iscap)
**描 述: HexCharToValue的反运算
**
**输 入: val:0-0x0f 
         iscap: 输出的ascii是否为大写 
**输 出: 0xFF:无法转换 
         如val=11, 若iscap为真则输出'B';为假,则输出'b'.
**
**备 注: 
**-----------------------------------------------------------------------
**作 者: yzy
**日 期: 
*************************************************************************/
//uint8 ValueToHexChar(uint8 val, bool iscap);

/************************************************************************
**函数名称: uint8 DecimalNumToBcdString(uint8* ch, uint32 num, uint8 digit)
**描 述: 将32位hex转换成带小数点的BCD字符串
**
**输 入: ch 输出缓存 
**       num 4字节数据
**       digit 小数位数(<= 4)
**输 出: 转换后的长度
**
**备 注: 若num = 32264,digit = 4,则输出"3.2264",返回6 
**       若num = 365,digit = 4,则输出"0.0365",返回6
**-----------------------------------------------------------------------
**作 者: yzy
**日 期: 2009-06-15
*************************************************************************/
uint8 DecimalNumToBcdString(uint8* ch, uint32 num, uint8 digit);





/************************************************************************
**函数名称: bool StepDays(uint8* time, int16 step)
**描 述: 对时间进行日步进
**
**输 入: time YYMMDD(hex,年在前)
         step 步进的天数
**输 出: 
**
**备 注: 如time指向 08-01-31 23点,step = 2,则输出time为 08-02-01 01点
**--------------------------------------------------------
**作 者: yzy
**日 期: 
*************************************************************************/
bool StepDays(uint8* time, int16 step);

/************************************************************************
**函数名称: void GD01ToHexTime(uint8* dat, uint8* hex)
**描 述: 国电01格式转为hex格式日期(ssmmHHDDMMYY)
**
**输 入: 
**输 出: 
**
**备 注: 
**--------------------------------------------------------
**作 者: yzy
**日 期: 2008-12-09
*************************************************************************/
void GD01ToHexTime(uint8* dat, uint8* hex);

/************************************************************************
**函数名称: uint16 GD07ToHex22(uint8* dat)
**描 述: 
**
**输 入: 
**输 出: 
**
**备 注:
**--------------------------------------------------------
**作 者: yzy
**日 期: 
*************************************************************************/
uint16 GD07ToHex22(uint8* dat);

/************************************************************************
**函数名称: int16 GD06ToShex22(uint8* dat)
**描 述: 
**
**输 入: 
**输 出: 
**
**备 注: 
**--------------------------------------------------------
**作 者: yzy
**日 期: 
*************************************************************************/
int16 GD06ToShex22(uint8* dat);

/************************************************************************
**函数名称: int32 GD06ToShex43(uint8* dat)
**描 述: 
**
**输 入: 
**输 出: 
**
**备 注: 
**--------------------------------------------------------
**作 者: yzy
**日 期: 
*************************************************************************/
int32 GD06ToShex43(uint8* dat);

/************************************************************************
**函数名称: int16 GD05ToShex23(uint8* dat)
**描 述: 国电05格式转为shex2.3
**
**输 入: 
**输 出: 
**
**备 注: 
**--------------------------------------------------------
**作 者: yzy
**日 期: 09-11-24
*************************************************************************/
int16 GD05ToShex23(uint8* dat);

/************************************************************************
**函数名称: uint32 GD23ToHex44(uint8* dat)
**描 述: 
**
**输 入: 
**输 出: 
**
**备 注: 
**--------------------------------------------------------
**作 者: yzy
**日 期: 
*************************************************************************/
uint32 GD23ToHex44(uint8* dat);

/************************************************************************
**函数名称: uint32 GD25ToShex43(uint8* dat)
**描 述: 国电25格式转为hex4.3
**
**输 入: 
**输 出: 
**
**备 注: 
**--------------------------------------------------------
**作 者: yzy
**日 期: 09-09-01
*************************************************************************/
int32 GD25ToShex43(uint8* dat);

/************************************************************************
**函数名称: int32 GD03ToShex42(uint8* dat)
**描 述: 
**
**输 入: 
**输 出: 无论输入为kwh还是mwh,输出都统一为kwh单位
**
**备 注: 
**--------------------------------------------------------
**作 者: yzy
**日 期: 
*************************************************************************/
int32 GD03ToShex42(uint8* dat);

/************************************************************************
**函数名称: int32 GD02ToShex44(uint8* dat)
**描 述: 将国电02格式装换层hex4.4格式
**
**输 入: 
**输 出: 
**
**备 注: 
**--------------------------------------------------------
**作 者: yzy
**日 期: 
*************************************************************************/
int32 GD02ToShex44(uint8* dat);

/************************************************************************
**函数名称: void Shex22ToGD05(int16 dat, uint8* buf)
**描 述: shex2.2格式到国电05格式
**
**输 入: 
**输 出: 
**
**备 注: 
**--------------------------------------------------------
**作 者: yzy
**日 期: 
*************************************************************************/
void Shex22ToGD05(int16 dat, uint8* buf);

/************************************************************************
**函数名称: Shex23ToGD05(int16 dat, uint8 *buf)
**描 述: 将Shex2.3格式的数据转换为国电规约05格式
**输 入: dat:要转换的数据
         buf:存储转换数据的指针
**输 出: 
**--------------------------------------------------------
**作　者: 
**日　期: 
*************************************************************************/
void Shex23ToGD05(int16 dat, uint8 *buf);

/************************************************************************
**函数名称: Shex23ToGD05Percent(int16 dat, uint8 *buf)
**描述: 将Shex2.3格式的数据转换为国电规约05格式
**输入: dat:要转换的数据
        buf:存储转换数据的指针
**输出: 
**--------------------------------------------------------
**作　者: 
**日　期: 
*************************************************************************/
void Shex23ToGD05Percent(int16 dat, uint8 *buf);


/************************************************************************
**函数名称: void Hex43ToGD06(uint32 dat, uint8 *buf)
**描 述: hex4.3转换为国电格式06
**
**输 入: 
**输 出: 
**
**备 注: 
**--------------------------------------------------------
**作 者: yzy
**日 期: 
*************************************************************************/
void Hex43ToGD06(uint32 dat, uint8 *buf);


/************************************************************************
**函数名称: void Hex22ToGD07(uint16 dat, uint8 *buf)
**描 述: hex2.2转换为国电格式07
**
**输 入: dat:要转换的数据 
**       buf:存储转换数据的指针 
**输 出: 
**
**备 注: 
**--------------------------------------------------------
**作 者: 
**日 期: 
*************************************************************************/
void Hex22ToGD07(uint16 dat, uint8 *buf);


/************************************************************************
**名 称: void Shex44ToGD09(int32 dat, uint8 *buf)
**描 述: 将Shex4.4格式转换为国电规约09格式
**输 入: dat:要转换的数据
         buf:存储转换数据的指针
**输 出: 如 data = 0xFFFFFFFF(-0.0001)
**       转换后*buf 后为0x01, 0x00, 0x80
**--------------------------------------------------------
**作 者: 
**日 期: 
*************************************************************************/
void Shex44ToGD09(int32 dat, uint8 *buf);


/************************************************************************
**函数名称: void Hex42ToGD11(uint32 dat, uint8* buf)
**描 述: Hex42ToGD11格式转换成国电11格式
**
**输 入: 
**输 出: 
**
**备 注: 
**--------------------------------------------------------
**作 者: yzy
**日 期: 09-09-09
*************************************************************************/
void Hex42ToGD11(uint32 dat, uint8* buf);

/************************************************************************
**函数名称: void Hex42ToGD13(uint32 dat, uint8* buf)
**描 述: Hex42格式转换成国电13格式
**
**输 入: 
**输 出: 
**
**备 注: 
**-----------------------------------------------------------------------
**作 者: yzy
**日 期: 10-02-25
*************************************************************************/
void Hex42ToGD13(uint32 dat, uint8* buf);

/************************************************************************
**函数名称: void Hex42ToGD14(uint32 dat, uint8* buf)
**描 述: 
**
**输 入: 
**输 出: 
**
**备 注: 
**--------------------------------------------------------
**作 者: yzy
**日 期: 09-01-13
*************************************************************************/
void Hex42ToGD14(uint32 dat, uint8* buf);


/************************************************************************
**名 称: void Shex44ToGD23(int32 data, uint8 *buf)
**描 述: Shex4.4格式转换为国电23格式(无符号)
**输 入:    
**输 出: 如 data = 0xFFFFFFFF(-1); 转换后*buf 后为0x01, 0x00, 0x00
**说 明: 格式23类似与格式09,只是少了符号
**--------------------------------------------------------
**作 者: 
**日 期: 
*************************************************************************/
void Shex44ToGD23(int32 data, uint8 *buf);


/************************************************************************
**函数名称: void Shex43ToGD25(uint32 dat, uint8 *buf)
**描 述: shex4.3转换为国电格式25
**
**输 入: 
**输 出: 
**
**备 注: 
**--------------------------------------------------------
**作 者: yzy
**日 期: 09-09-25
*************************************************************************/
void Shex43ToGD25(int32 dat, uint8* buf);


/************************************************************************
**函数名称: void Shex44ToGD02(uint8* buffer, int32 data)
**描 述: 
**
**输 入: 
**输 出: 
**
**备 注: 
**--------------------------------------------------------
**作 者: yzy
**日 期: 
*************************************************************************/
void Shex44ToGD02(uint8* buffer, int32 data);


/************************************************************************
**函数名称: void Shex42ToGD03(uint8* buffer, int32 data);
**描 述: 
**
**输 入: 
**输 出: 
**
**备 注: 一般使用kwh单位,若超出kwh表示范围则使用Mwh.
**--------------------------------------------------------
**作 者: yzy
**日 期: 2009-01-03
*************************************************************************/
void Shex42ToGD03(uint8* buffer, int32 data);




/************************************************************************
 * @function: HexTimeToGD01
 * @描述: 年月日时分秒转国电格式01
 * 
 * @参数: 
 * @param: YMDHms 
 * @param: data 
 * @返回: 
 * @说明: 
 * @作者: yzy (2011-9-30)
 *-----------------------------------------------------------------------
 * @修改人: 
 ************************************************************************/
void HexTimeToGD01(uint8* YMDHms, uint8* data);








#endif


